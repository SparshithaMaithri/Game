<!DOCTYPE html>
<html>
<head>
    <title>Number Matching Game</title>
    <style>
        .number-card { display: inline-block; width: 50px; height: 50px; margin: 10px; font-size: 24px; background-color: #eee; text-align: center; line-height: 50px; cursor: pointer; }
        .matched { background-color: #aaffaa; }
    </style>
</head>
<body>
    <h1>Number Matching Game</h1>
    <div>
        <h2>Points: <span id="score">{{ score }}</span></h2>
    </div>
    <div id="game-board">
        {% for idx, num in numbers %}
            <div class="number-card" data-idx="{{ idx }}">{{ num }}</div>
        {% endfor %}
    </div>
    <script>
        let first = null, second = null;
        let matched = [];
        document.querySelectorAll('.number-card').forEach(function(card) {
            card.onclick = function() {
                if(matched.includes(card.dataset.idx)) return;
                if(first === null) {
                    first = card;
                    card.style.backgroundColor = '#aaaaff';
                } else if(second === null && card !== first) {
                    second = card;
                    card.style.backgroundColor = '#aaaaff';
                    // Send selection to backend
                    fetch('/match', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ first: first.dataset.idx, second: second.dataset.idx })
                    }).then(resp => resp.json()).then(data => {
                        document.getElementById('score').textContent = data.score;
                        if(data.matched) {
                            first.classList.add('matched');
                            second.classList.add('matched');
                            matched.push(first.dataset.idx, second.dataset.idx);
                        }
                        setTimeout(() => {
                            first.style.backgroundColor = '';
                            second.style.backgroundColor = '';
                            first = second = null;
                        }, 800);
                    });
                }
            }
        });
    </script>
</body>
</html>
